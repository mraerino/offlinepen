<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-route/app-route.html">

<dom-module id="view-editor">
  <template>
    <style>
    </style>

    <app-route route="[[ route ]]" pattern="/:penId" data="{{ routeData }}" active="{{ editorActive }}"></app-route>

    <header>
      <a href="/list" title="Back to pen list">&lt;</a>
      <h1>Pen: [[ penMeta.name ]]</h1>
    </header>
  </template>
</dom-module>

<script>
  class ViewEditor extends Polymer.Element {
    static get is() { return 'view-editor'; }

    static get properties() {
      return {
        route: {
          type: Object
        },
        currentId: {
          type: String,
          value: () => "",
          observer: 'fetchPen'
        },
        penMeta: {
          type: Object
        }
      };
    }

    static get observers() {
      return [
        'routeChanged(routeData.*, editorActive)'
      ];
    }

    routeChanged(change, active) {
      if(!active) {
        this.currentId = "";
        this.dispatchEvent(new CustomEvent('op-navigateTo', {
          detail: { path: '/list' },
          bubbles: true,
          composed: true
        }));
        return;
      }

      if(change.base && change.base.penId) {
        this.currentId = change.base.penId;
      }
    }

    fetchPen(id) {
      OfflinePen.db.pens.get(id).then(pen => this.penMeta = pen);
    }
  }

  customElements.define(ViewEditor.is, ViewEditor);
</script>
